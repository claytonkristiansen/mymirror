<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        var GoogleAuth;
        var SCOPE = 'https://www.googleapis.com/auth/drive.metadata.readonly';
        function handleClientLoad() {
            // Load the API's client and auth2 modules.
            // Call the initClient function after the modules load.
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            // In practice, your app can retrieve one or more discovery documents.
            var discoveryUrl = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';

            // Initialize the gapi.client object, which app uses to make API requests.
            // Get API key and client ID from API Console.
            // 'scope' field specifies space-delimited list of access scopes.
            gapi.client.init({
                'apiKey': 'YOUR_API_KEY',
                'clientId': 'YOUR_CLIENT_ID',
                'discoveryDocs': [discoveryUrl],
                'scope': SCOPE
            }).then(function () {
                GoogleAuth = gapi.auth2.getAuthInstance();

                // Listen for sign-in state changes.
                GoogleAuth.isSignedIn.listen(updateSigninStatus);

                // Handle initial sign-in state. (Determine if user is already signed in.)
                var user = GoogleAuth.currentUser.get();
                setSigninStatus();

                // Call handleAuthClick function when user clicks on
                //      "Sign In/Authorize" button.
                $('#sign-in-or-out-button').click(function () {
                    handleAuthClick();
                });
                $('#revoke-access-button').click(function () {
                    revokeAccess();
                });
            });
        }

        function handleAuthClick() {
            if (GoogleAuth.isSignedIn.get()) {
                // User is authorized and has clicked "Sign out" button.
                GoogleAuth.signOut();
            } else {
                // User is not signed in. Start Google auth flow.
                GoogleAuth.signIn();
            }
        }

        function revokeAccess() {
            GoogleAuth.disconnect();
        }

        function setSigninStatus() {
            var user = GoogleAuth.currentUser.get();
            var isAuthorized = user.hasGrantedScopes(SCOPE);
            if (isAuthorized) {
                $('#sign-in-or-out-button').html('Sign out');
                $('#revoke-access-button').css('display', 'inline-block');
                $('#auth-status').html('You are currently signed in and have granted ' +
                    'access to this app.');
            } else {
                $('#sign-in-or-out-button').html('Sign In/Authorize');
                $('#revoke-access-button').css('display', 'none');
                $('#auth-status').html('You have not authorized this app or you are ' +
                    'signed out.');
            }
        }

        function updateSigninStatus() {
            setSigninStatus();
        }
    </script>

    <button id="sign-in-or-out-button" style="margin-left: 25px">Sign In/Authorize</button>
    <button id="revoke-access-button" style="display: none; margin-left: 25px">Revoke access</button>

    <div id="auth-status" style="display: inline; padding-left: 25px"></div>
    <hr>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()"
        onreadystatechange="if (this.readyState === 'complete') this.onload()">
        </script>

    <!-- <div id="g_id_onload" data-client_id="729667979950-8u5r6kkclsj5cisldvfbj51gfh07mnjn.apps.googleusercontent.com"
        data-login_uri="https://claytonkristiansen.github.io/mymirror/" data-auto_prompt="false"
        data-callback="handleCredentialResponse">
    </div> -->
    <script>
        // async function init() {
        //     // 2. Initialize the JavaScript client library.
        //     await gapi.client.init({ discoveryDocs: ['https://discovery.googleapis.com/$discovery/rest'] });
        //     start();
        // }
        // function handleCredentialResponse(response) {
        //     // decodeJwtResponse() is a custom function defined by you
        //     // to decode the credential response.
        //     //const responsePayload = decodeJwtResponse(response.credential);

        //     console.log(response);
        //     // console.log('Full Name: ' + responsePayload.name);
        //     // console.log('Given Name: ' + responsePayload.given_name);
        //     // console.log('Family Name: ' + responsePayload.family_name);
        //     // console.log("Image URL: " + responsePayload.picture);
        //     // console.log("Email: " + responsePayload.email);
        }

        function CalendarClickTest() {
            console.log("pressed");
            handleClientLoad();
            //initClient();
            //listUpcomingEvents();
        }
    </script>
    <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline" data-text="sign_in_with"
        data-shape="rectangular" data-logo_alignment="left">
    </div>
    <div class="current-date">
        <ul>
            <li id="day-num">
                <h1></h1>
            </li>
            <li id="day-month-year">
                <h2 id="day"></h2>
                <h2 id="month-year"></h2>
                <h2 id="time"></h2>
            </li>
        </ul>
        <script src="time.js"></script>
    </div>
    <div class="events">
        <div class="event-entry" id="1">
            <h1>Event Name</h1>
            <p>4-5PM</p>
        </div>
        <div class="event-entry" id="2">
            <h1>Event Name</h1>
            <p>4-5PM</p>
        </div>
        <div class="event-entry" id="3">
            <h1>Event Name</h1>
            <p>4-5PM</p>
        </div>
        <div class="event-entry" id="4">
            <h1>Event Name</h1>
            <p>4-5PM</p>
        </div>
    </div>
    <ul class="weather-container">
        <li id="condition"></li>
        <li>
            <p id="location" style="font-weight: bold;"></p>
            <p id="temp"></p>
        </li>
        <script>
            url = "https://api.openweathermap.org/data/2.5/weather?id=4682464&appid=70233fd63e460a06635ebd916c31fcf2&units=imperial"
            let response = fetch(url);
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    document.getElementById("location").innerHTML = data["name"];
                    document.getElementById("temp").innerHTML = Math.round(data["main"]["temp"]).toString() + "Â°";
                    document.getElementById("condition").innerHTML = "<img src=https://openweathermap.org/img/w/" + data["weather"]["0"]["icon"] + ".png></a>";
                });
        </script>
    </ul>
    <button onclick="CalendarClickTest()">CLICK</button>
</body>

</html>